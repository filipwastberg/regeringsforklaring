<!DOCTYPE html>
<html>
  <head>
    <title>Textanalys av Sveriges regeringsf√∂rklaring</title>
    <meta charset="utf-8">
    <meta name="author" content="Filip W√§stberg, Ferrologic" />
    <meta name="date" content="2018-03-06" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Textanalys av Sveriges regeringsf√∂rklaring
## üï∫ med R och tidytext
### Filip W√§stberg, Ferrologic
### 2018-03-06

---





# Vad √§r en regeringsf√∂rklaring? &amp;#x1F937;

---

# Var finns regeringsf√∂rklaringen? 

![](ds-meetup-presentation_files/figure-html/reg.png)

---

# Efter en del kodande och mycket copy paste


```r
library(tidyverse)
regf &lt;- read_csv("data/regf.csv")
```

---

# En data.frame med stycke, datum och statsminister


```
## # A tibble: 4,283 x 3
##    text                                           datum      statsminister 
##    &lt;chr&gt;                                          &lt;date&gt;     &lt;chr&gt;         
##  1 Regeringsf√∂rklaring, 19761008, Torbj√∂rn F√§lld‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  2 Regeringspartierna √§r ense om att finansdepar‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  3 I anslutning till denna anm√§lan vill jag ge r‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  4 Enighet har allts√• n√•tts mellan Centerpartiet‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  5 Med fasthet och ansvar skall vi f√∂ra en polit‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  6 Regeringen skall str√§va efter att bryta tende‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  7 Tryggheten f√∂r alla generationer och grupper ‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  8 Den sociala marknadshush√•llningen f√∂rst√§rks g‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
##  9 Regeringen skall f√∂ra en politik f√∂r syssels√§‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
## 10 Str√§ng hush√•llning m√•ste ske med naturtillg√•n‚Ä¶ 1976-10-08 Torbj√∂rn F√§ll‚Ä¶
## # ‚Ä¶ with 4,273 more rows
```

---
# Vad √§r vi intresserade av?
--

- Vilka ord som n√§mns

--

- Hur regeringsf√∂rklaringen √§ndrats √∂ver tid

--

- Vilka ord som √§r viktigast

---

# F√∂r att analysera text beh√∂ver den vara tidy

--
- Varje variabel √§r en kolumn

--
- Varje observation √§r en rad

--
- I v√•rt fall handlar det om varje ord ska vara uppdelat per statsminister och regeringsf√∂rklaring

--
- Data √§r allts√• inte tidy

---

# Vansinnigt enkelt att g√∂ra text tidy med `tidytext`


```r
library(tidytext)
tidy_regf &lt;- regf %&gt;%
  filter(!str_detect(text, "Regeringsf√∂rklaring")) %&gt;%
* unnest_tokens(ord, text)
```

---

# Tidy text data


```
## # A tibble: 129,341 x 3
##    datum      statsminister    ord                
##    &lt;date&gt;     &lt;chr&gt;            &lt;chr&gt;              
##  1 1976-10-08 Torbj√∂rn F√§lldin regeringspartierna 
##  2 1976-10-08 Torbj√∂rn F√§lldin √§r                 
##  3 1976-10-08 Torbj√∂rn F√§lldin ense               
##  4 1976-10-08 Torbj√∂rn F√§lldin om                 
##  5 1976-10-08 Torbj√∂rn F√§lldin att                
##  6 1976-10-08 Torbj√∂rn F√§lldin finansdepartementet
##  7 1976-10-08 Torbj√∂rn F√§lldin s√•                 
##  8 1976-10-08 Torbj√∂rn F√§lldin snart              
##  9 1976-10-08 Torbj√∂rn F√§lldin som                
## 10 1976-10-08 Torbj√∂rn F√§lldin m√∂jligt            
## # ‚Ä¶ with 129,331 more rows
```

---

# Stoppord &amp;#x1F640;

- Ord som *och*, *s√•*, *att* och s√• vidare
- Finns lista i :

```r
get_stopwords(language = "sv", source = "snowball")
```

```
## # A tibble: 114 x 2
##    word  lexicon 
##    &lt;chr&gt; &lt;chr&gt;   
##  1 och   snowball
##  2 det   snowball
##  3 att   snowball
##  4 i     snowball
##  5 en    snowball
##  6 jag   snowball
##  7 hon   snowball
##  8 som   snowball
##  9 han   snowball
## 10 p√•    snowball
## # ‚Ä¶ with 104 more rows
```
---
# Stoppord &amp;#x1F640;

- Kompletterar med lista fr√•n forskaren [Peter Dahlgren](https://gist.github.com/peterdalle/8865eb918a824a475b7ac5561f2f88e9) fr√•n G√∂teborgs universitet


```r
sv_stoppord &lt;- read_csv("https://gist.githubusercontent.com/peterdalle/8865eb918a824a475b7ac5561f2f88e9/raw/cc1d05616e489576c1b934289711f041ff9b2281/swedish-stopwords.txt", col_names = FALSE) %&gt;%
  rename(stoppord = X1)
```

```
## Parsed with column specification:
## cols(
##   X1 = col_character()
## )
```

---

# Tv√§tta data


```r
tv√§ttade_regf &lt;- tidy_regf %&gt;%
* filter(!str_detect(ord, "[[:digit:]]")) %&gt;%
  anti_join(get_stopwords(language = "sv"), by = c("ord" = "word")) %&gt;%
  anti_join(sv_stoppord, by = c("ord" = "stoppord"))
```

---

# Tv√§tta data


```r
tv√§ttade_regf &lt;- tidy_regf %&gt;%
  filter(!str_detect(ord, "[[:digit:]]")) %&gt;% 
* anti_join(get_stopwords(language = "sv"), by = c("ord" = "word")) %&gt;%
  anti_join(sv_stoppord, by = c("ord" = "stoppord"))
```

---

# Tv√§tta data


```r
tv√§ttade_regf &lt;- tidy_regf %&gt;%
  filter(!str_detect(ord, "[[:digit:]]")) %&gt;% 
  anti_join(get_stopwords(language = "sv"), by = c("ord" = "word")) %&gt;% 
* anti_join(sv_stoppord, by = c("ord" = "stoppord"))
```

---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;
                                    
---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---
![](ds-meetup-presentation_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;
                                    
---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---

# Vilka √§r de viktigaste orden f√∂r respektive statsminister?

---

# Texten √§r skev!

- Zipfs law

&lt;img src="ds-meetup-presentation_files/figure-html/george-zipf.jpg" width="300px" style="display: block; margin: auto;" /&gt;

---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

---

# Karen Sp√§rck Jones 

&lt;img src="ds-meetup-presentation_files/figure-html/karen.jpg" width="300px" /&gt;

Foto Fr√•n: University of Cambridge, &lt;a href="https://creativecommons.org/licenses/by/2.5" title="Creative Commons Attribution 2.5"&gt;CC BY 2.5&lt;/a&gt; &lt;a href="https://commons.wikimedia.org/w/index.php?curid=4734533"&gt;&lt;/a&gt;

---

# Term frequency‚Äìinverse document frequency

$$ tf-idf(term) = tf(term) * idf(term) $$
--

$$ tf(term) = f_t$$

--


`$$idf(\text{term}) = \ln{\left(\frac{n_{\text{documents}}}{n_{\text{documents containing term}}}\right)}$$`
---

# Term frequency‚Äìinverse document frequency
 
- Skapar en vikt f√∂r ord baserat p√• hur ofta de f√∂rekommer i varje regeringsf√∂rklaring 

--

- Kombinera med *term frequency* och vi kan ta fram de "viktigaste" orden f√∂r repsektive statsminister
---

# Term frequency‚Äìinverse document frequency

- Exempel:

--

- Sveriges regering s√§tter kampen mot **arbetsl√∂sheten** fr√§mst

--

- Sverige regering s√§tter kampen mot **terrorism** fr√§mst

---

![](ds-meetup-presentation_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---
- filip.wastberg@ferrologic.se
- All kod f√∂r presentationen: https://github.com/filipwastberg/regeringsforklaring
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
